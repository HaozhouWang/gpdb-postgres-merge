create table ao_basic_t1 (a int, b varchar) using appendoptimized distributed by (a);
-- Validate that the appendoptimized table access method will be used
-- for this table.
select amhandler from pg_class c, pg_am a where c.relname = 'ao_basic_t1' and c.relam = a.oid;
         amhandler          
----------------------------
 appendonly_tableam_handler
(1 row)

select count(*) = 1 from pg_appendonly where relid = 'ao_basic_t1'::regclass;
 ?column? 
----------
 t
(1 row)

insert into ao_basic_t1 values (1, 'abc'), (2, 'pqr'), (3, 'lmn');
insert into ao_basic_t1 select i, i from generate_series(1,12)i;
select * from ao_basic_t1;
 a  |  b  
----+-----
  1 | abc
  1 | 1
 12 | 12
  2 | pqr
  3 | lmn
  2 | 2
  3 | 3
  4 | 4
  7 | 7
  8 | 8
  5 | 5
  6 | 6
  9 | 9
 10 | 10
 11 | 11
(15 rows)

select gp_segment_id, * from ao_basic_t1;
 gp_segment_id | a  |  b  
---------------+----+-----
             2 |  5 | 5
             2 |  6 | 6
             2 |  9 | 9
             2 | 10 | 10
             2 | 11 | 11
             0 |  2 | pqr
             0 |  3 | lmn
             0 |  2 | 2
             0 |  3 | 3
             0 |  4 | 4
             0 |  7 | 7
             0 |  8 | 8
             1 |  1 | abc
             1 |  1 | 1
             1 | 12 | 12
(15 rows)

select gp_segment_id, count(*) from ao_basic_t1 group by gp_segment_id;
 gp_segment_id | count 
---------------+-------
             0 |     7
             1 |     3
             2 |     5
(3 rows)

insert into ao_basic_t1 values (1, repeat('abc', 100000));
select a, length(b) from ao_basic_t1;
 a  | length 
----+--------
  2 |      3
  3 |      3
  2 |      1
  3 |      1
  4 |      1
  7 |      1
  8 |      1
  5 |      1
  6 |      1
  9 |      1
 10 |      2
 11 |      2
  1 |      3
  1 |      1
 12 |      2
  1 | 300000
(16 rows)

create index i_ao_basic_t1 on ao_basic_t1 using btree(a);
select * from ao_basic_t1 where a = 2;
 a |  b  
---+-----
 2 | pqr
 2 | 2
(2 rows)

create table heap_t2(a int, b varchar) distributed by (a);
insert into heap_t2 select i, i from generate_series(1, 20)i;
select * from ao_basic_t1 t1 join heap_t2 t2 on t1.a=t2.a where t1.a != 1;
 a  |  b  | a  | b  
----+-----+----+----
  2 | 2   |  2 | 2
  2 | pqr |  2 | 2
  3 | 3   |  3 | 3
  3 | lmn |  3 | 3
  4 | 4   |  4 | 4
  7 | 7   |  7 | 7
  8 | 8   |  8 | 8
  5 | 5   |  5 | 5
  6 | 6   |  6 | 6
  9 | 9   |  9 | 9
 10 | 10  | 10 | 10
 11 | 11  | 11 | 11
 12 | 12  | 12 | 12
(13 rows)

create table ao_basic_t2 (a int) using appendoptimized distributed by (a);
insert into ao_basic_t2 select i from generate_series(1,20)i;
alter table ao_basic_t2 add column b varchar default 'abc';
select * from ao_basic_t2;
 a  |  b  
----+-----
  2 | abc
  3 | abc
  4 | abc
  7 | abc
  8 | abc
 16 | abc
 18 | abc
 19 | abc
  5 | abc
  6 | abc
  9 | abc
 10 | abc
 11 | abc
 13 | abc
 14 | abc
 17 | abc
  1 | abc
 12 | abc
 15 | abc
 20 | abc
(20 rows)

insert into ao_basic_t2 select  i, 'new column' from generate_series(1,12)i;
select * from ao_basic_t2 where b != 'abc';
 a  |     b      
----+------------
  2 | new column
  3 | new column
  4 | new column
  7 | new column
  8 | new column
  1 | new column
 12 | new column
  5 | new column
  6 | new column
  9 | new column
 10 | new column
 11 | new column
(12 rows)

