#!/usr/bin/perl
#----------------------------------------------------------------------
#
# duplicate_oids
#    Identifies any manually-assigned OIDs that are used multiple times
#    in the Postgres catalog data.
#
#    While duplicate OIDs would only cause a failure if they appear in
#    the same catalog, our project policy is that manually assigned OIDs
#    should be globally unique, to avoid confusion.
#
# Portions Copyright (c) 1996-2019, PostgreSQL Global Development Group
# Portions Copyright (c) 1994, Regents of the University of California
#
# src/include/catalog/duplicate_oids
#
#----------------------------------------------------------------------

use strict;
use warnings;

<<<<<<< HEAD
BEGIN
{
	@ARGV = (glob("pg_*.h"), glob("gp_*.h"), qw(indexing.h toasting.h));
}
=======
# Must run in src/include/catalog
use FindBin;
chdir $FindBin::RealBin or die "could not cd to $FindBin::RealBin: $!\n";

use lib "$FindBin::RealBin/../../backend/catalog/";
use Catalog;

my @input_files = (glob("pg_*.h"), qw(indexing.h toasting.h));

my $oids = Catalog::FindAllOidsFromHeaders(@input_files);
>>>>>>> 9e1c9f959422192bbe1b842a2a1ffaf76b080196

my %oidcounts;

foreach my $oid (@{$oids})
{
	$oidcounts{$oid}++;
}

my $found = 0;

foreach my $oid (sort { $a <=> $b } keys %oidcounts)
{
	next unless $oidcounts{$oid} > 1;
	$found = 1;
	print "$oid\n";
}

exit $found;
